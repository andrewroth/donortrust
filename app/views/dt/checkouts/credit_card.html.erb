<%- content_for :head do -%><%= stylesheet_link_tag 'dt/cart' %><%- end -%>
<%- content_for :html_title do -%>Checkout &ndash; Step 2 of 3<%- end -%>
<%- content_for :nav do -%><%= checkout_nav %><%- end -%>

<%= error_messages_for :order %>
<% form_for(:order, :url => dt_checkout_path, :html => {:id => "orderform", :name => "orderform"}) do |f| %>
<div class="userform">

  <%= render :partial => 'dt/shared/form_requirednote', :locals => { :style => 'margin-bottom:0px;' } %>
 
  <fieldset>
    <legend>100% of your funds go to the project(s) you select</legend>
    <p>We spend over 3% on each transaction. Would you like to help cover our costs?</p>
    <ol>
      <li>
        <fieldset>
          <ol>
            <li>
              <label class="left"><%= radio_button_tag "fund_cf", nil, false, :onchange => "if(this.checked)$('fund_cf_amount').hide();" %> Not this time - I acknowledge my greediness</label>
              <label class="left"><%= radio_button_tag "fund_cf", "percent", false, :onchange => "if(this.checked){$('fund_cf_amount').show();$('fund_cf_dollars_symbol').hide();$('fund_cf_percent_symbol').show();}" %> Add a percentage to my investment</label>
              <label class="left"><%= radio_button_tag "fund_cf", "dollars", false, :onchange => "if(this.checked){$('fund_cf_amount').show();$('fund_cf_percent_symbol').hide();$('fund_cf_dollars_symbol').show();}" %> Add a specific a dollar amount</label>
            </li>
          </ol>
        </fieldset>
      </li>
      <li id="fund_cf_amount"><label>Amount <span id="fund_cf_percent_symbol" style="display:none;">%</span><span id="fund_cf_dollars_symbol" style="display:none;">$</span></label> <%= text_field_tag "fund_cf_amount" %></li>
    </ol>
  </fieldset>
  
  <fieldset>
    <legend>Pay from My Account Balance</legend>
    <p class="textsm" style="color:#C00;"><strong>Note: This is faked for now - let's pretend you're a logged in user.</strong></p>
    <div class="notes">
      <h5>Account Balance</h5>
      <p>You can pay any non-deposit items out of your account balance, which is currently <strong><%= logged_in? ? number_to_currency(current_user.balance) : number_to_currency(50) %></strong>.</p>
    </div>
    <p>Current Balance: <strong><%= logged_in? ? number_to_currency(current_user.balance) : number_to_currency(50) %></strong></p>
    <p>Up to $75.00 of your cart total can be paid for with your account balance, if you so choose.</p>
    <ol>
      <li><label>Amount</label> <%= f.text_field :account_balance_total %></li>
    </ol>
  </fieldset>

  <fieldset>
    <legend>Credit Card Information</legend>
    <%= render :partial => 'dt/shared/form_requirednote', :locals => { :style => 'margin-bottom:0px;' } %>
    <div class="notes">
      <h5>Credit Card Information</h5>
      <p>We do <strong>not</strong> store your credit card number.</p>
    </div>
    <ol>
      <li><label for="order_credit_card"><%= form_required %>Credit Card</label> <%= f.text_field :credit_card %></li>
      <li>
        <label for="order_csc"><%= form_required %>Card Security Number</label> <%= f.text_field :csc %>
        <div class="note">This is final 3 digits on the back of your card. For AMEX: 4 digits on the front of the card.</div>
      </li>
      <li><label for="order_expiry_month"><%= form_required %>Card Expiry</label> 
        <div id="ccExpiry">
          <%= f.select("expiry_month", (1..12).to_a.collect {|m| 
            mo = m.to_s.rjust(2, "0"); 
            [ mo, mo ] }, { :include_blank => true, :selected => @order.expiry_month.to_s.rjust(2, "0") }, { :style => 'width:auto;' }) -%>
          / <%= f.select("expiry_year", (0..7).to_a.collect {|y| 
            d = Date.civil(Date.today.year+y.to_i) 
            [ d.year.to_s, d.year.to_s[2, 2] ] }, { :include_blank => true }, { :style => 'width:auto;' }) %> 
        </div>
        </li>
      <li><label for="order_cardholder_name"><%= form_required %>Cardholder Name</label> <%= f.text_field :cardholder_name %></li>
    </ol>
  </fieldset>
</div>
<%= hidden_field_tag "confirm", "1" %>
<%= submit_tag 'Proceed to Step 3 &raquo;', :class => 'buttonsubmit' %>
<% end %>

<%- content_for :sidebar do -%>
  <h2>Your Cart</h2>
  <%= render "dt/cart/sidebar" %>  
  <%= render "dt/accounts/profile_sidebar" %>  
  <%= render :partial => 'dt/checkouts/verisign' %>
<%- end -%>