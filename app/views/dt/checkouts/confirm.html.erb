<%- content_for :head do -%>
<%= stylesheet_link_tag 'dt/cart' %>
<%= javascript_include_tag "dt/checkout" %>
<%- end -%>
<%- content_for :html_title do -%>Confirm Checkout - Step 3 of 3<%- end -%>
<%- content_for :nav do -%><%= checkout_nav %><%- end -%>


<h2>Step 3 of 3 - Confirmation</h2>

<%= render "dt/cart/sidebar" %>  

<%= error_messages_for :order %>
<% form_for(:order, :url => dt_checkout_path, :html => {:id => "orderform", :name => "orderform"}) do |f| %>
<div class="userform">

  <fieldset style="margin-top:1em;">
    <legend>Billing and Tax Receipt Information</legend>
    <div class="notes clearfix">
      <h5>Billing and Tax Receipt Information</h5>
      <p>Please enter the information associated with your credit card. This information will also be associated with your tax receipt, if applicable.</p>
    </div>
    <ol>
      <li><label>Donor Type</label> <%=h @order.donor_type %> <%= f.hidden_field :donor_type %></li>
      <li><label>Title</label> <%=h @order.title %> <%= f.hidden_field :title %></li>
      <li><label>First Name</label> <%=h @order.first_name %> <%= f.hidden_field :first_name %></li>
      <li><label>Last Name</label> <%=h @order.last_name %> <%= f.hidden_field :last_name %></li>
      <li><label>Company</label> <%=h @order.company %> <%= f.hidden_field :company %></li>
      <li><label>Street Address</label> <%=h @order.address %> <%= f.hidden_field :address %></li>
      <li><label>Street Address 2</label> <%=h @order.address2 %> <%= f.hidden_field :address2 %></li>
      <li><label>City</label> <%=h @order.city %> <%= f.hidden_field :city %></li>
      <li><label>Province</label> <%=h @order.province %> <%= f.hidden_field :province %></li>
      <li><label>Postal/Zip Code</label> <%=h @order.postal_code %> <%= f.hidden_field :postal_code %></li>
      <li><label>Country</label> <%=h @order.country %> <%= f.hidden_field :country %></li>
      <li><label>Province</label> <%=h @order.province %> <%= f.hidden_field :province %></li>
      <li><label>Email</label> <%=h @order.email %> <%= f.hidden_field :email %></li>
    </ol>
  </fieldset>
  
  <fieldset>
    <legend>100% of your funds go to the project(s) you select</legend>
    <p>You have chosen to give <strong>$25.00</strong> to ChristmasFuture directly. Thank You!</p>
  </fieldset>
  
  <fieldset>
    <legend>Payment Summary</legend>
    <%# if @order.account_balance_total? %>
    <h5>Account Payment Information</h5>
    <ol class="clearfix" style="border:1px solid #CCC;padding:4px;">
      <li><label>Cart Total</label><strong><%= number_to_currency(@cart.total) %></strong></li>
      <li><label>Account Balance</label><strong><%= logged_in? ? number_to_currency(current_user.balance) : number_to_currency(50) %></strong><%= hidden_field_tag :account_balance, (logged_in? ? current_user.balance : 50), :id => 'account_balance' %></li>
      <li><label>Account Payment</label> <%= number_to_currency(@order.account_balance_total) %></li>
      <li><label>Remaining Subtotal</label> <%= number_to_currency(@cart.total - @order.account_balance_total.to_f) %></li>
    </ol>
    <%# end %>
    <h5>Credit Card Payment Information</h5>
    <div class="notes">
      <h5>Credit Card Information</h5>
      <p>We do <strong>not</strong> store your credit card number.</p>
    </div>
    <p>The remaining balance of <strong><%= number_to_currency(@cart.total - @order.account_balance_total.to_f) %></strong> will be charged to your credit card</p>
    <%= render :partial => 'dt/shared/form_requirednote', :locals => { :style => 'margin-bottom:0px;' } %>
    <ol class="clearfix" style="border:1px solid #CCC;padding:4px;">
      <li><label>Credit Card</label><%=h @order.credit_card_concealed %></li>
      <li><label>Card Security Number</label> <%=h @order.csc.gsub(/./, "*") %></li>
      <li><label>Card Expiry</label> <%=h @order.expiry_month %> / <%=h @order.expiry_year %></li>
      <li><label>Cardholder Name</label> <%=h @order.cardholder_name %> <%= f.hidden_field :cardholder_name %></li>
    </ol>
  </fieldset>
</div>
<%= hidden_field_tag "step", "complete" %>
<%= submit_tag 'Complete Checkout', :class => 'buttonsubmit' %>
<% end %>
<%= button_to "&laquo; Go Back a Step", new_dt_checkout_path(:step => 'payment'), :method => :get, :class => "buttonsubmit" %>

<%- content_for :sidebar do -%>
  <%= render "dt/accounts/profile_sidebar" %>  
<%- end -%>